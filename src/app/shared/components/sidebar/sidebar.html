<!-- Mobile Overlay -->
@if (isMobileMenuOpen()) {
  <div class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden" (click)="toggleMobileMenu()"></div>
}

<!-- Sidebar -->
<aside
  [class.translate-x-0]="isMobileMenuOpen()"
  [class.w-20]="!isSidebarExpanded()"
  [class.w-64]="isSidebarExpanded()"
  class="fixed left-0 top-0 h-full bg-white border-r border-gray-200 z-50 transform -translate-x-full transition-all duration-300 ease-in-out lg:translate-x-0 lg:static lg:z-auto overflow-y-auto"
>
  <!-- Logo -->
  <div class="p-4 border-b border-gray-200">
    <div class="flex items-center space-x-2 justify-center lg:justify-start">
      <div class="w-10 h-10 flex items-center justify-center text-lg font-bold text-blue-600">
        R
      </div>
      @if (isSidebarExpanded()) {
        <span class="hidden lg:block font-bold text-gray-800">Rayna</span>
      }
    </div>
  </div>

  <!-- Menu Items -->
  <nav class="p-4 space-y-1">
    @for (item of menuItems; track item.label) {
      <div class="mb-1">
        <!-- Parent Menu Item -->
        <div
          (click)="toggleMenuItem(item)"
          [routerLink]="!item.children ? item.route : null"
          routerLinkActive="bg-blue-50 text-blue-600"
          [routerLinkActiveOptions]="{ exact: false }"
          class="flex items-center justify-center lg:justify-between px-4 py-3 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors group"
          [attr.title]="item.label"
        >
          <div class="flex items-center space-x-3">
            <!-- Dynamic Icon: Component or String -->
            @if (isComponent(item.icon)) {
              <ng-container *ngComponentOutlet="$any(item.icon); inputs: { size: 20 }" />
            } @else {
              <span class="text-xl">{{ item.icon }}</span>
            }

            @if (isSidebarExpanded()) {
              <span class="hidden lg:block text-sm font-medium text-gray-700 group-hover:text-gray-900">
                {{ item.label }}
              </span>
            }
          </div>

          <!-- Dropdown Arrow -->
          @if (item.children && isSidebarExpanded()) {
            <svg
              [class.rotate-180]="item.expanded"
              class="hidden lg:block w-4 h-4 text-gray-400 transition-transform"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              />
            </svg>
          }
        </div>

        <!-- Child Menu Items -->
        @if (item.children && item.expanded && isSidebarExpanded()) {
          <div class="hidden lg:block ml-4 mt-1 space-y-1 border-l-2 border-gray-200 pl-4">
            @for (child of item.children; track child.label) {
              <a
                [routerLink]="child.route"
                routerLinkActive="bg-blue-50 text-blue-600 font-medium"
                class="block px-4 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50 hover:text-gray-900 transition-colors"
              >
                {{ child.label }}
              </a>
            }
          </div>
        }
      </div>
    }
  </nav>
</aside>
